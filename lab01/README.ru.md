# Лабораторная работа 01: Сложение и умножение

[RU|[EN](README.md)]

Целью этой работы является ознакомление с окружением.

## Цель

Вам нужно реализовать простой калькулятор над целыми десятичными числами с поддержкой сложения и умножения.
Грамматика входных строк определяется следующей [РБНФ][EBNF]-грамматикой:

```EBNF
expr = 
    number
  | expr "+" expr 
  | expr "*" expr 
  | "(" expr ")" ;

number = digit { digit } ;
digit = "0" | "1" | "2" | "3" | "4" | "5" | "6" | "7" | "8" | "9" ;
```

Это - типичный способ описания структуры арифметических выражений. Ради краткости, в этом определении опущены детали, которые могут быть важными для пользователя:

- Пробельные символы в РБНФ не упоминаются, но интуитивно мы ожидаем их поддержки (игнорирования при использовании между элементами правил-нетерминалов)
- Фактические числа, поддерживаемые калькулятором, будут иметь ограниченную длину, хотя в РБНФ описание подразумевает неограниченные последовательности цифр
- Несмотря на то, что вышеприведенная РБНФ позволяет нам отличить определенно некорректные выражения от грамматически корректных, она оставляет некоторый простор интерпретации. Естественно, пользователь будет ожидать соблюдения привычных правил приоритетов, так что результатом вычисления выражения `1+2*3` является `7`, а не `9`.

Все эти подробности необходимо описать в "промышленной" грамматике. Реальные компиляторы редко основываются на РБНФ, хотя все применяемые на практике построители парсеров вдохновлены различными диалектами БНФ, и РБНФ в частности.

В рамках данного курса мы будем использовать PEG - [Parsing Expression Grammars][PEG] - для синтаксического разбора текстов программ. Наш конкретный диалект реализован библиотекой [Ohm](https://ohmjs.org/), которая предоставляет ряд продв  инутых возможностей, что делает ее хорошим выбором для практических применений.

## Задания

1. Постройте PEG-грамматику для арифметических выражений, описанных вышеприведенной РБНФ, используя синтаксис библиотеки Ohm.
  Пустой шаблон грамматики приведен в файле [addmul.ohm](src/addmul.ohm). Заполните его необходимыми правилами.

2. Реализуйте семантическое действие `calculate()` для этой грамматики, которое будет возвращать `number` - результат вычисления разобранного выражения.
  Пустое определение этого действия приведено в файле [calculate.ts](src/calculate.ts). Заполните его необходимыми правилами.
3. Реализуйте и экспортируйте композитную функцию `parse(content: string): number` в файле [index.ts](src/index.ts). Эта функция должна
   - разобрать входную строку при помощи грамматики, реализованной в задаче 1
   - в случае ошибки разбора выбросить исключение `SyntaxError`
   - в случае успеха разбора, применить семантическое действие `calculate`, реализованное в задаче 2, к результату разбора (объекту match) и вернуть результат этого применения

## Оценка

- C | 3 | Воу, воу, полегче:
  - Реализовать базовый разбор чисел, сложения, умножения
  - Корректно обработать ошибки разбора
- B | 4 | Ломай меня полностью:
  - Корректно реализовать приоритеты операций
  - Поддержать опциональные скобки
  - Поддержать пробелы, табуляцию, и переводы строк в текстах выражений

## Советы

1. Библиотека Ohm предоставляет [интерактивный редактор грамматик](https://ohmjs.org/editor/) с отладкой. Это поможет разобраться в причинах непрохождения тестов.
2. Typescript проверяет соответствие семантических действий грамматикам Ohm, но для этого необходимо убедиться, что файл определений типов соответствует "свежей" грамматике. Не забывайте выполнять сборку при помощи `pnpm build` (`Shift-Ctrl-B` в VS Code) после каждого изменения файла *.ohm для обновления определений типов. Иначе IDE засыплет вас нерелевантными сообщениями об ошибках.
3. Придание приоритетов операциям потребует от вас расщепления грамматики на несколько правил, см. более подробное изложение в [infix.ru.md](infix.ru.md).
4. При разработке грамматики обратите внимание на то, что Ohm автоматически учитывает пробельные символы в "синтаксических" правилах - тех, названия которых начинаются с заглавной буквы. См. раздел [Syntactic vs Lexical Rules](https://ohmjs.org/docs/syntax-reference#syntactic-lexical) в руководстве по синтаксису Ohm.

[EBNF]: https://ru.wikipedia.org/wiki/%D0%A0%D0%B0%D1%81%D1%88%D0%B8%D1%80%D0%B5%D0%BD%D0%BD%D0%B0%D1%8F_%D1%84%D0%BE%D1%80%D0%BC%D0%B0_%D0%91%D1%8D%D0%BA%D1%83%D1%81%D0%B0_%E2%80%94_%D0%9D%D0%B0%D1%83%D1%80%D0%B0
[PEG]: https://ru.wikipedia.org/wiki/%D0%93%D1%80%D0%B0%D0%BC%D0%BC%D0%B0%D1%82%D0%B8%D0%BA%D0%B0,_%D1%80%D0%B0%D0%B7%D0%B1%D0%B8%D1%80%D0%B0%D1%8E%D1%89%D0%B0%D1%8F_%D0%B2%D1%8B%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5
