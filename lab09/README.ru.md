# Лабораторная работа 09: Компиляция Funny

[RU|[EN](README.md)]

Цель этой работы - создание компилятора языка Funny в байткод виртуальной машины Wasm.

## Цель

В этой работе мы добавим к парсеру, построенному в [предыдущей работе](../lab08/README.ru.md), генератор байткода Wasm.

Сам код генератора будет относительно прямолинейным. Обратите внимание на следующее:

1. Ссылки на переменные в Wasm превращаются в обращения по  индексу в списке переменных функции. [Лабораторная работа 05](../lab05/README.ru.md) частично делает это для аргументов функции. Локальные переменные в Wasm добавляются в тот же список, что и параметры, т.е. в функции двух аргументов переменная номер 2 ссылается на первую локальную переменную, 3 на вторую, и так далее. Присваивание локальной переменной выполняется при помощи инструкции [`local.set`][local.set].
2. Язык Funny обращается с возвращаемыми значениями функции так же, как с обычными переменными; так что их тоже нужно учитывать как локальные переменные при построении заголовка функции в Wasm.
3. В конце тела функции нам нужно положить возвращаемые значения на стек.

## Задачи

1. Реализуйте в файле [compiler.ts](src/compiler.ts) функцию `compileModule()` , которая строит по модулю на языке Funny модуль WebAssembly .

## Оценка

- C | 3 | Воу, воу, полегче:
  - Реализуйте компиляцию модулей с единственной функцией
  - Реализуйте поддержку целочисленных входных и выходных параметров функции
  - Реализуйте компиляцию функций, возвращающих единственное значение
  - Реализуйте поддержку операторов присваивания
  - Реализуйте поддержку блочных операторов
  - Обрабатывайте комментарии
- B | 4 | Ломай меня полностью:
  - Реализуйте компиляцию функций с несколькими возвращаемыми значениями
  - Реализуйте компиляцию модулей с несколькими функциями
  - Реализуйте поддержку вызовов функций в выражениях
  - Реализуйте поддержку условных операторов
  - Реализуйте поддержку операторов цикла
- A | 5 | Мне все ультрафиолетово:
  - Реализуйте поддержку массивов для входных и выходных параметров
  - Реализуйте поддержку для операций обращения к массиву и присваивания элементов массива
  - Реализуйте поддержку присваивания кортежей

[local.set]: https://developer.mozilla.org/en-US/docs/WebAssembly/Reference/Variables/Local_set
